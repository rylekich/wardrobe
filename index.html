<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WARDROBE ONLINE</title>
    <link rel="stylesheet" href="styles.css">
  </head>
  <body>
    <aside id="fitting-room">
        <h1>kyle richardson wardrobe online</h1>
    </aside>
    <main>
            <section id="head">
                <h2>Hats</h2>
            </section>
            <section id="dresses">
                <h2>Dresses</h2>
            </section>
            <section id="sweaters">
                <h2>Sweaters</h2>
            </section>
            <section id="shoulders">
                <h2>Tops</h2>
            </section>
            <section id="knees">
                <h2>Bottoms</h2>
            </section>
            <section id="toes">
                <h2>Shoes</h2>
            </section>
            <section id="outerwear">
                <h2>Outerwear</h2>
            </section>
        <footer class="misc"> </footer>
    </main>

        <script>
            const API =
              "https://script.google.com/macros/s/AKfycbwHLt452t8JDefnlGuGHiyP_KBmuJXIUunRrQ25g4UhlCmcH6IkvdaxdcgaLy6vYCVO/exec";
      
            // Mapping of clothing types to their corresponding section IDs
            const TYPE_TO_SECTION = {
              Hat: "head",
              Dress: "dresses",
              Sweater: "sweaters",
              Top: "shoulders",
              Bottom: "knees",
              Shoes: "toes",
              Outerwear: "outerwear",
            };
      
            // Create clothing item element
            function createClothingItem(row) {
              const div = document.createElement("div");
              div.className = `item ${row.Type}`;
      
              const template = [
                ["img", { src: row.Photo }],
                ["p", { className: "brand", textContent: row.Brand }],
                ["p", { className: "size", textContent: row.Size }],
                ["p", { className: "condition", textContent: row.Condition}],                
                [
                  "p",
                  {
                    className: "hate-or-love",
                    textContent: `Feels good on? ${row["Feel good in it"]}`,
                  },
                ],
                ["p", { className: "status", textContent: `Status: ${row["Status"]}` }],
              ];
      
              for (const [tag, props] of template) {
                const el = document.createElement(tag);
                Object.assign(el, props);
                div.appendChild(el);
              }
      
              return div;
            }
      
            // Organize clothing items into their sections
            function organizeItemsByType() {
              for (const [type, sectionId] of Object.entries(TYPE_TO_SECTION)) {
                const section = document.getElementById(sectionId);
                if (!section) continue;
      
                const items = document.querySelectorAll(`.item.${type}`);
                for (const item of items) {
                  section.appendChild(item);
                }
              }
            }
      
            // Main
            fetch(API)
              .then((res) => res.json())
              .then(({ data }) => {
                const container = document.querySelector(".misc");
                const fragment = document.createDocumentFragment();

                for (const row of data[0].children) {
                  fragment.appendChild(createClothingItem(row));
                }

                container.appendChild(fragment);
                organizeItemsByType();

                // Now images exist, attach listeners
                const pieces = document.querySelectorAll("img");
                const fittingRoom = document.querySelector("aside#fitting-room");

                pieces.forEach((piece) => {
                  piece.addEventListener("click", function () {
                    console.log("img clicked:", this.src);
                    fittingRoom.appendChild(this.cloneNode());
                  });
                });

                fittingRoom.addEventListener("click", function (e) {
                  if (e.target.tagName === "IMG") {
                    e.target.remove(); // removes the clicked image
                  }
                });

              })
              .catch((err) => console.error("Error fetching API:", err));
          </script>
    </body>
</html>
